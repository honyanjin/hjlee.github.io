import{j as e,X as M,K as v,x as F,N as X,i as Z,R as _}from"./ui-E6zqGgdH.js";import{r as s}from"./router-CLvrYEWH.js";import{s as g}from"./index-45WOxMk0.js";const ee=({onImageUpload:m,currentImage:N,className:G="",bucketName:a="blog-images"})=>{const[$,k]=s.useState(!1),[A,u]=s.useState(!1),[w,o]=s.useState(""),C=s.useRef(null),[b,i]=s.useState(!1),[p,S]=s.useState(!1),[D,z]=s.useState(""),[l,E]=s.useState([]),[B,L]=s.useState(0),[O,T]=s.useState(!1),[h,q]=s.useState(""),f=40,I=async r=>{if(r){if(r.size>5*1024*1024){o("파일 크기는 5MB 이하여야 합니다.");return}if(!r.type.startsWith("image/")){o("이미지 파일만 업로드 가능합니다.");return}try{k(!0),o("");const t=r.name.split(".").pop(),d=`${Date.now()}.${t}`,{error:n}=await g.storage.from(a).upload(d,r,{cacheControl:"3600",upsert:!1});if(n)throw n;const{data:c}=g.storage.from(a).getPublicUrl(d);m(c.publicUrl)}catch(t){o(t.message||"이미지 업로드에 실패했습니다.")}finally{k(!1)}}},H=r=>{const t=r.target.files?.[0];t&&I(t)},y=r=>{r.preventDefault(),r.stopPropagation(),r.type==="dragenter"||r.type==="dragover"?u(!0):r.type==="dragleave"&&u(!1)},J=r=>{r.preventDefault(),r.stopPropagation(),u(!1);const t=r.dataTransfer.files?.[0];t&&I(t)},K=()=>{m("")},P=()=>a==="project-images"?"💡 권장: 1200×630px (19:10 비율) - 프로젝트 썸네일용":"💡 권장: 896×384px (7:3 비율) - 블로그 헤더용",j=async(r=!1)=>{S(!0),z("");try{const t=r?0:B,{data:d,error:n}=await g.storage.from(a).list("",{limit:f,offset:t*f,sortBy:{column:"name",order:"desc"}});if(n)throw n;const c=(d||[]).map(x=>{const{data:W}=g.storage.from(a).getPublicUrl(x.name);return{name:x.name,url:W.publicUrl}});E(x=>r?c:[...x,...c]),T((d?.length||0)===f),L(r?1:t+1)}catch(t){z(t.message||"이미지 목록을 불러오지 못했습니다.")}finally{S(!1)}},R=()=>{i(!0)};s.useEffect(()=>{b&&l.length===0&&j(!0)},[b]);const U=s.useMemo(()=>{const r=h.trim().toLowerCase();return r?l.filter(t=>t.name.toLowerCase().includes(r)):l},[l,h]);return e.jsxs("div",{className:`space-y-4 ${G}`,children:[w&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 px-4 py-3 rounded-md",children:w}),N?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:N,alt:"업로드된 이미지",className:"w-full h-64 sm:h-80 lg:h-96 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:K,className:"absolute top-2 right-2 bg-red-600 text-white p-1 rounded-full hover:bg-red-700 transition-colors",children:e.jsx(M,{size:16})}),e.jsxs("button",{type:"button",onClick:R,className:"absolute top-2 left-2 bg-white/90 dark:bg-gray-800/90 text-gray-800 dark:text-gray-200 px-2 py-1 rounded-md shadow hover:bg-white dark:hover:bg-gray-700 transition-colors flex items-center gap-1",children:[e.jsx(v,{size:14}),"라이브러리에서 선택"]})]}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:P()})})]}):e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${A?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"}`,onDragEnter:y,onDragLeave:y,onDragOver:y,onDrop:J,children:[e.jsx("input",{ref:C,type:"file",accept:"image/*",onChange:H,className:"hidden"}),$?e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(F,{className:"h-8 w-8 text-blue-600 animate-spin"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"이미지 업로드 중..."})]}):e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900 rounded-full",children:e.jsx(X,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"이미지를 드래그하여 업로드하거나"}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>C.current?.click(),className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium",children:"파일 선택"}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsxs("button",{type:"button",onClick:R,className:"text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium flex items-center gap-1",children:[e.jsx(v,{size:16})," 라이브러리에서 선택"]})]})]}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF 최대 5MB"}),e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:P()})]})]})]}),b&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>i(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-5xl bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:18,className:"text-blue-600"}),e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:["버킷에서 이미지 선택 (",a,")"]})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(M,{size:18})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx(Z,{size:16,className:"absolute left-2 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:h,onChange:r=>q(r.target.value),placeholder:"파일명 검색",className:"w-full pl-8 pr-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:()=>{E([]),L(0),j(!0)},className:"inline-flex items-center gap-1 px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(_,{size:16})," 새로고침"]})})]}),D&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 px-4 py-3 rounded-md",children:D}),e.jsx("div",{className:"min-h-[200px]",children:p&&l.length===0?e.jsxs("div",{className:"flex items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(F,{className:"h-5 w-5 mr-2 animate-spin"})," 불러오는 중..."]}):U.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"이미지가 없습니다."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:U.map(r=>e.jsxs("button",{type:"button",onClick:()=>{m(r.url),i(!1)},className:"group relative border border-gray-200 dark:border-gray-700 rounded-md overflow-hidden hover:ring-2 hover:ring-blue-500",title:r.name,children:[e.jsx("img",{src:r.url,alt:r.name,className:"w-full h-28 object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent p-1",children:e.jsx("p",{className:"text-[10px] text-white truncate",children:r.name})})]},r.name))})}),O&&e.jsx("div",{className:"flex justify-center pt-2",children:e.jsx("button",{type:"button",disabled:p,onClick:()=>j(!1),className:"px-4 py-2 text-sm rounded-md border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:p?"불러오는 중...":"더 보기"})})]})]})})]})]})};export{ee as I};
