import{j as e,m as p,Q as T,X as D,a0 as $,T as E,W as A,I}from"./ui-DZss5j7o.js";import{r as m}from"./router-CLvrYEWH.js";import{a as L,b as P,o as R,n as H,c as h,s as f}from"./index-D65f1dRP.js";const Q=R({name:h().min(2,"카테고리명은 2글자 이상이어야 합니다"),slug:h().min(2,"슬러그는 2글자 이상이어야 합니다").regex(/^[a-z0-9-]+$/,"영문 소문자, 숫자, 하이픈만 사용 가능합니다"),description:h().optional(),color:h().regex(/^#[0-9A-F]{6}$/i,"올바른 색상 코드를 입력하세요 (예: #3B82F6)"),icon:h().optional(),sort_order:H().min(0,"순서는 0 이상이어야 합니다").optional()}),G=({title:n,description:b,tableName:w,categories:y,loading:j,error:g,onFetchCategories:v,onSaveCategory:l,onDeleteCategory:c,showSortOrder:x=!1})=>{const[u,s]=m.useState(null),[o,t]=m.useState(!1),{register:a,handleSubmit:S,formState:{errors:i},reset:C,setValue:d,watch:F}=L({resolver:P(Q)}),z=F("color","#3B82F6"),q=async r=>{try{await l(r,u),k()}catch(N){console.error("Error saving category:",N)}},B=r=>{s(r.id),d("name",r.name),d("slug",r.slug),d("description",r.description||""),d("color",r.color),d("icon",r.icon||""),x&&d("sort_order",r.sort_order||0),t(!0)},M=async r=>{confirm("정말로 이 카테고리를 삭제하시겠습니까?")&&await c(r)},k=()=>{s(null),t(!1),C()},_=()=>{s(null),t(!0),C({name:"",slug:"",description:"",color:"#3B82F6",icon:"",sort_order:0})};return j?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:n}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:b})]}),e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(p.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:_,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(T,{size:20}),e.jsx("span",{children:"새 카테고리"})]})}),g&&e.jsx(p.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:g}),o&&e.jsxs(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:u?"카테고리 수정":"새 카테고리"}),e.jsx("button",{onClick:k,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(D,{size:20})})]}),e.jsxs("form",{onSubmit:S(q),className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"카테고리명 *"}),e.jsx("input",{...a("name"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"예: React"}),i.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"슬러그 *"}),e.jsx("input",{...a("slug"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"예: react"}),i.slug&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.slug.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"설명"}),e.jsx("textarea",{...a("description"),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"카테고리에 대한 설명을 입력하세요"})]}),e.jsxs("div",{className:`grid ${x?"md:grid-cols-3":"md:grid-cols-2"} gap-6`,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"색상 *"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{...a("color"),type:"color",className:"w-12 h-10 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer",onChange:r=>d("color",r.target.value)}),e.jsx("input",{...a("color"),className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"#3B82F6"})]}),i.color&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.color.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"아이콘"}),e.jsx("input",{...a("icon"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"예: react"})]}),x&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"정렬 순서"}),e.jsx("input",{...a("sort_order",{valueAsNumber:!0}),type:"number",min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"0"}),i.sort_order&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i.sort_order.message})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 rounded-full",style:{backgroundColor:z}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"미리보기"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"목록에서 이 색상이 사용됩니다"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:k,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"취소"}),e.jsxs("button",{type:"submit",className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx($,{size:16}),e.jsx("span",{children:u?"수정":"생성"})]})]})]})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map((r,N)=>e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:N*.1},className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white",style:{backgroundColor:r.color},children:e.jsx(E,{size:16})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.slug})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B(r),className:"p-2 text-gray-600 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",children:e.jsx(A,{size:16})}),e.jsx("button",{onClick:()=>M(r.id),className:"p-2 text-gray-600 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors",children:e.jsx(I,{size:16})})]})]}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:r.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[x&&e.jsxs("span",{children:["순서: ",r.sort_order]}),e.jsxs("span",{children:["생성일: ",new Date(r.created_at).toLocaleDateString()]}),e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:r.color}})]})]},r.id))}),y.length===0&&!o&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"카테고리가 없습니다"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"첫 번째 카테고리를 생성해보세요."}),e.jsx("button",{onClick:_,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"카테고리 생성"})]})]})},J=({tableName:n,showSortOrder:b=!1})=>{const[w,y]=m.useState([]),[j,g]=m.useState(!0),[v,l]=m.useState(""),c=async()=>{try{g(!0),l("");const s=f.from(n).select("*");b&&s.order("sort_order",{ascending:!0}),s.order("created_at",{ascending:!1});const{data:o,error:t}=await s;if(t)throw t;y(o||[])}catch(s){l("카테고리를 불러오는데 실패했습니다."),console.error("Error fetching categories:",s)}finally{g(!1)}},x=async(s,o)=>{try{if(l(""),o){const{error:t}=await f.from(n).update({name:s.name,slug:s.slug,description:s.description,color:s.color,icon:s.icon,...b&&{sort_order:s.sort_order}}).eq("id",o);if(t)throw t}else{const{error:t}=await f.from(n).insert([s]);if(t)throw t}await c()}catch(t){throw l("카테고리 저장에 실패했습니다."),console.error("Error saving category:",t),t}},u=async(s,o)=>{if(confirm(o||"정말로 이 카테고리를 삭제하시겠습니까?"))try{l("");const{error:a}=await f.from(n).delete().eq("id",s);if(a)throw a;await c()}catch(a){throw l("카테고리 삭제에 실패했습니다."),console.error("Error deleting category:",a),a}};return m.useEffect(()=>{c()},[n]),{categories:w,loading:j,error:v,fetchCategories:c,saveCategory:x,deleteCategory:u}};export{G as C,J as u};
