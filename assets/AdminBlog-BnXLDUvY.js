import{j as e,T as h,Q as w,m as k,V as b,o as _,U as N,q as D,O as z,W as S,I as E}from"./ui-PyLpIfzO.js";import{r as n,a as C}from"./router-CLvrYEWH.js";import{s as o,A as P}from"./index-Bon6P73N.js";import{A as q}from"./AdminPageHeader-MoPJ4cBD.js";import"./vendor-RGnvvjkK.js";const R=()=>{const[a,i]=n.useState([]),[u,g]=n.useState(!0),[m,d]=n.useState(""),l=C();n.useEffect(()=>{y()},[]);const y=async()=>{try{g(!0);const{data:r,error:t}=await o.from("blog_posts").select("*").order("published_at",{ascending:!1}).order("created_at",{ascending:!1});if(t)throw t;const s=(r||[]).sort((c,x)=>{const v=c.published_at?new Date(c.published_at):new Date(c.created_at);return(x.published_at?new Date(x.published_at):new Date(x.created_at)).getTime()-v.getTime()});i(s)}catch(r){d("포스트를 불러오는데 실패했습니다."),console.error("Error fetching posts:",r)}finally{g(!1)}},p=async r=>{if(confirm("정말로 이 포스트를 삭제하시겠습니까?"))try{const{error:t}=await o.from("blog_posts").delete().eq("id",r);if(t)throw t;i(a.filter(s=>s.id!==r))}catch(t){d("포스트 삭제에 실패했습니다."),console.error("Error deleting post:",t)}},j=async r=>{try{const{error:t}=await o.from("blog_posts").update({is_published:!r.is_published,published_at:r.is_published?null:new Date().toISOString()}).eq("id",r.id);if(t)throw t;i(a.map(s=>s.id===r.id?{...s,is_published:!s.is_published}:s))}catch(t){d("포스트 상태 변경에 실패했습니다."),console.error("Error updating post:",t)}},f=async r=>{try{const{error:t}=await o.from("blog_posts").update({is_recommended:!r.is_recommended}).eq("id",r.id);if(t)throw t;i(a.map(s=>s.id===r.id?{...s,is_recommended:!s.is_recommended}:s))}catch(t){d("추천 상태 변경에 실패했습니다."),console.error("Error updating recommendation:",t)}};return u?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e.jsx(P,{children:e.jsxs("div",{className:"p-8",children:[e.jsxs(q,{title:"블로그 관리",description:"블로그 포스트를 관리하고 새로운 포스트를 작성합니다.",children:[e.jsxs("button",{onClick:()=>l("/admin/blog/categories"),className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(h,{size:16}),"포스트 카테고리"]}),e.jsxs("button",{onClick:()=>l("/admin/blog/new"),className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(w,{size:16}),"새 포스트"]})]}),m&&e.jsx("div",{className:"mb-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 px-4 py-3 rounded-md",children:m}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["포스트 목록 (",a.length,")"]})}),a.length===0?e.jsxs("div",{className:"px-6 py-12 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:"아직 포스트가 없습니다."}),e.jsx("button",{onClick:()=>l("/admin/blog/new"),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"첫 포스트 작성하기"})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:a.map(r=>e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r.title}),e.jsxs("div",{className:"flex items-center gap-1",children:[r.is_recommended&&e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(b,{size:12}),"추천"]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${r.is_published?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}`,children:r.is_published?"발행됨":"임시저장"})]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-2 line-clamp-2",children:r.excerpt}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{size:14}),e.jsx("span",{children:r.published_at?new Date(r.published_at).toLocaleDateString():new Date(r.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{size:14}),e.jsx("span",{children:r.category})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{size:14}),e.jsx("span",{children:r.author})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>f(r),className:`p-2 rounded-lg transition-colors ${r.is_recommended?"bg-yellow-100 text-yellow-600 dark:bg-yellow-900 dark:text-yellow-400":"text-gray-400 hover:text-yellow-600 dark:hover:text-yellow-400"}`,title:r.is_recommended?"추천 해제":"추천",children:e.jsx(b,{size:16})}),e.jsx("button",{onClick:()=>j(r),className:`p-2 rounded-lg transition-colors ${r.is_published?"bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-400":"text-gray-400 hover:text-green-600 dark:hover:text-green-400"}`,title:r.is_published?"발행 취소":"발행",children:r.is_published?e.jsx(D,{size:16}):e.jsx(z,{size:16})}),e.jsx("button",{onClick:()=>l(`/admin/blog/edit/${r.id}`),className:"p-2 text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",title:"편집",children:e.jsx(S,{size:16})}),e.jsx("button",{onClick:()=>p(r.id),className:"p-2 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:"삭제",children:e.jsx(E,{size:16})})]})]})},r.id))})]})]})})};export{R as default};
