import{j as e,o as Y,C as T,Y as P,Z as M,q as Q,g as X,m as v,J as ee,_ as re,K as se,$ as te,w as ae,a0 as le}from"./ui-DZss5j7o.js";import{r as t,a as ie,b as de}from"./router-CLvrYEWH.js";import{d as z,I as oe,u as ne,e as ce,a as xe,b as ge,o as me,s as j,A as U,F as be,f as he,c as u}from"./index-D65f1dRP.js";import{A as pe}from"./AdminPageHeader-CBcrBf_d.js";import{I as ue}from"./ImageUpload-Dtlo88vX.js";import{R as ye}from"./RichTextEditor-CTpYoa8s.js";const je=({categories:s,isCollapsed:x=!1,onToggleCollapse:b})=>{const{register:o,formState:{errors:a},watch:h}=z(),n=h("title"),p=i=>i.toLowerCase().replace(/[^a-zA-Z0-9가-힣]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),l=n?`${window.location.origin}/blog/${p(n)}`:"";return e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:b,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"기본 정보"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"포스트의 기본 정보를 입력합니다"})]})]}),e.jsx("button",{type:"button",className:"p-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors","aria-label":x?"펼치기":"접기",children:x?e.jsx(T,{size:20,className:"text-gray-500 dark:text-gray-400"}):e.jsx(P,{size:20,className:"text-gray-500 dark:text-gray-400"})})]})}),!x&&e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"제목 *"}),e.jsx("input",{...o("title"),type:"text",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"포스트 제목을 입력하세요"}),a.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:String(a.title.message)})]}),n&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"URL 미리보기"}),e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-mono break-all",children:l})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"제목을 기반으로 자동 생성됩니다"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"카테고리 *"}),e.jsxs("select",{...o("category"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"카테고리를 선택하세요"}),s.map(i=>e.jsx("option",{value:i.name,children:i.name},i.id))]}),a.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:String(a.category.message)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"태그"}),e.jsx("input",{...o("tags"),type:"text",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"태그를 쉼표로 구분하여 입력하세요 (예: React, TypeScript, Web)"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"쉼표로 구분하여 여러 태그를 입력할 수 있습니다"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"요약 *"}),e.jsx("textarea",{...o("excerpt"),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"포스트의 요약을 입력하세요"}),a.excerpt&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:String(a.excerpt.message)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"블로그 목록에서 표시될 요약 내용입니다"})]})]})]})},fe=({isCollapsed:s=!0,onToggleCollapse:x,redirectAfterSave:b,setRedirectAfterSave:o,previewDraftInNewTab:a,setPreviewDraftInNewTab:h})=>{const{register:n,formState:{errors:p}}=z();return e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",onClick:x,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"발행 설정"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"포스트 발행 상태와 관련 설정을 관리합니다"})]})]}),e.jsx("button",{type:"button",className:"p-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors","aria-label":s?"펼치기":"접기",children:s?e.jsx(T,{size:20,className:"text-gray-500 dark:text-gray-400"}):e.jsx(P,{size:20,className:"text-gray-500 dark:text-gray-400"})})]})}),!s&&e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:[e.jsx("input",{...n("is_published"),type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{children:"즉시 발행"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"체크하면 포스트가 즉시 공개됩니다. 체크하지 않으면 임시저장 상태로 유지됩니다."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"저장 후 동작"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:l=>o(l.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{children:"저장 후 블로그 목록으로 이동"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:l=>h(l.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{children:"저장 후 새 탭에서 미리보기"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-600 dark:text-blue-400",children:[e.jsx(Q,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"발행 상태 안내"})]})}),e.jsxs("div",{className:"mt-2 text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"발행됨:"})," 모든 사용자가 볼 수 있는 공개 상태"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"임시저장:"})," 관리자만 볼 수 있는 비공개 상태"]}),e.jsx("p",{children:"• 발행된 포스트는 언제든지 임시저장으로 되돌릴 수 있습니다"})]})]})]})]})},ke=me({title:u().min(1,"제목을 입력해주세요"),content:u().min(10,"내용은 10자 이상이어야 합니다"),excerpt:u().min(1,"요약을 입력해주세요"),category:u().min(1,"카테고리를 선택해주세요"),tags:u().optional(),is_published:he()}),Ne=({mode:s})=>{const[x,b]=t.useState(s==="edit"),[o,a]=t.useState(!1),[h,n]=t.useState(""),[p,l]=t.useState(""),[i,E]=t.useState(null),[w,S]=t.useState(""),[R,B]=t.useState([]),[C,D]=t.useState(!1),[I,$]=t.useState(!0),[_,F]=t.useState(!0),[A,H]=t.useState(!1),{user:q}=ne(),f=ie(),{id:k}=de(),{open:ve}=ce(),N=xe({resolver:ge(ke),defaultValues:{is_published:!1}}),{watch:O,setValue:g,formState:{errors:L}}=N,V=O("content"),y=s==="edit"&&i?`${window.location.origin}/blog/${i.id}`:"";t.useEffect(()=>{s==="edit"&&k&&Z(),G()},[s,k]);const Z=async()=>{try{b(!0);const{data:r,error:d}=await j.from("blog_posts").select("*").eq("id",k).single();if(d)throw d;E(r),g("title",r.title),g("content",r.content),g("excerpt",r.excerpt),g("category",r.category),g("tags",r.tags?r.tags.join(", "):""),g("is_published",r.is_published),S(r.image_url||"")}catch(r){n("포스트를 불러오는데 실패했습니다."),console.error("Error fetching post:",r)}finally{b(!1)}},G=async()=>{try{const{data:r,error:d}=await j.from("categories").select("*").order("name");if(d)throw d;B(r||[])}catch(r){console.error("Error fetching categories:",r)}},J=async r=>{try{a(!0),n(""),l("");const d={title:r.title,content:r.content,excerpt:r.excerpt,category:r.category,tags:r.tags?r.tags.split(",").map(m=>m.trim()).filter(m=>m):[],is_published:r.is_published,image_url:w,author:q?.email||"Unknown",published_at:r.is_published?new Date().toISOString():null,updated_at:new Date().toISOString()};let c;if(s==="edit"&&i?c=await j.from("blog_posts").update(d).eq("id",i.id):c=await j.from("blog_posts").insert([{...d,created_at:new Date().toISOString()}]),c.error)throw c.error;if(l("포스트가 저장되었습니다."),_)f("/admin/blog");else if(A&&c.data){const m=Array.isArray(c.data)?c.data[0]:c.data;m&&"id"in m&&window.open(`/blog/${m.id}`,"_blank")}}catch(d){n("포스트 저장에 실패했습니다."),console.error("Error saving post:",d)}finally{a(!1)}},K=r=>{S(r)},W=()=>{y&&(navigator.clipboard.writeText(y),l("URL이 클립보드에 복사되었습니다."),setTimeout(()=>l(""),2e3))};return x?e.jsx(U,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{className:"animate-spin h-8 w-8 text-blue-600"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"포스트를 불러오는 중..."})]})})}):e.jsx(U,{children:e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(pe,{title:s==="edit"?"포스트 편집":"새 포스트 작성",description:s==="edit"?"기존 포스트를 수정합니다.":"새로운 블로그 포스트를 작성합니다.",children:e.jsxs(v.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>f("/admin/blog"),className:"flex items-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:[e.jsx(ee,{size:16}),"목록으로"]})}),h&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-400 px-4 py-3 rounded-md",children:h}),p&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-600 dark:text-green-400 px-4 py-3 rounded-md",children:p}),e.jsx(be,{...N,children:e.jsxs("form",{onSubmit:N.handleSubmit(J),className:"space-y-8",children:[e.jsx(je,{categories:R,isCollapsed:C,onToggleCollapse:()=>D(!C)}),e.jsx(fe,{isCollapsed:I,onToggleCollapse:()=>$(!I),redirectAfterSave:_,setRedirectAfterSave:F,previewDraftInNewTab:A,setPreviewDraftInNewTab:H}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"대표 이미지"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"포스트의 대표 이미지를 설정합니다"})]})]})}),e.jsx("div",{className:"p-6",children:e.jsx(ue,{currentImage:w,onImageUpload:K,bucketName:"blog-images"})})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"h-5 w-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"본문 내용"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"포스트의 메인 내용을 작성합니다"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx(ye,{value:V,onChange:r=>g("content",r),placeholder:"포스트 내용을 입력하세요..."}),L.content&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:L.content.message})]})]}),s==="edit"&&y&&e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"미리보기 URL"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"발행된 포스트의 URL입니다"})]})]}),e.jsxs("button",{type:"button",onClick:W,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ae,{size:16}),"복사"]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-mono break-all",children:y})})})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-gray-200 dark:border-gray-600",children:[e.jsx(v.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",onClick:()=>f("/admin/blog"),className:"px-6 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"취소"}),e.jsxs(v.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",disabled:o,className:"flex items-center gap-2 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(le,{size:16}),o?"저장 중...":"저장"]})]})]})})]})})},Le=({mode:s})=>e.jsx(oe,{children:e.jsx(Ne,{mode:s})});export{Le as A};
