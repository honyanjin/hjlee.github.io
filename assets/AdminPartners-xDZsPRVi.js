import{j as e}from"./ui-DCVn0oQs.js";import{r as d}from"./router-CLvrYEWH.js";import{o as R,_ as F,c as o,a as M,b as V,s as l}from"./index-BJQaA9zI.js";import"./vendor-RGnvvjkK.js";const J=()=>{const[u,_]=d.useState([]),[S,b]=d.useState(!0),[k,i]=d.useState(""),[C,g]=d.useState(!1),[m,y]=d.useState(null),[j,E]=d.useState([]),[p,f]=d.useState([]),[w,v]=d.useState(null),I=d.useMemo(()=>R({email:o().email("올바른 이메일을 입력하세요"),password:o().min(6,"비밀번호는 6자 이상이어야 합니다").optional(),name:o().optional(),company:o().optional(),status:F(["active","inactive"])}),[]),{register:n,handleSubmit:P,reset:A,formState:{errors:c,isSubmitting:N}}=M({resolver:V(I),defaultValues:{email:"",password:"",name:"",company:"",status:"active"}}),x=async()=>{try{b(!0);const{data:t,error:a}=await l.from("partner_profiles").select("user_id, email, name, company, status, created_at").order("created_at",{ascending:!1});if(a)throw a;_(t??[])}catch(t){i(t.message||"로딩 실패")}finally{b(!1)}};d.useEffect(()=>{x()},[]);const q=()=>{A({email:"",password:"",name:"",company:"",status:"active"}),g(!0)},O=async t=>{try{i("");const{data:a,error:r}=await l.functions.invoke("create-partner-user",{body:{email:t.email,password:t.password,name:t.name,company:t.company,status:t.status}});if(r)throw r;if(!a||!a.user_id)throw new Error("파트너 생성에 실패했습니다");g(!1),await x()}catch(a){i(a.message||"생성 실패")}},U=async t=>{if(confirm("프로필을 삭제하시겠습니까? 할당도 함께 삭제됩니다."))try{const{error:a}=await l.from("partner_profiles").delete().eq("user_id",t);if(a)throw a;await x()}catch(a){i(a.message||"삭제 실패")}},z=async(t,a)=>{try{const r=a==="active"?"inactive":"active",{error:s}=await l.from("partner_profiles").update({status:r}).eq("user_id",t);if(s)throw s;await x()}catch(r){i(r.message||"상태 변경 실패")}},D=async t=>{try{i(""),y({user_id:t});const[{data:a},{data:r}]=await Promise.all([l.from("partner_pages").select("id, title").order("title",{ascending:!0}),l.from("partner_page_assignments").select("page_id").eq("user_id",t)]);E(a??[]),f((r??[]).map(s=>s.page_id))}catch(a){i(a.message||"할당 데이터 로딩 실패")}},L=async()=>{if(m)try{const t=m.user_id,{error:a}=await l.from("partner_page_assignments").delete().eq("user_id",t);if(a)throw a;if(p.length>0){const r=p.map(h=>({user_id:t,page_id:h})),{error:s}=await l.from("partner_page_assignments").insert(r);if(s)throw s}y(null)}catch(t){i(t.message||"할당 저장 실패")}};return e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"파트너 프로필"}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-gray-700 dark:text-gray-300",children:["총 ",u.length,"개"]}),e.jsx("button",{onClick:q,className:"px-3 py-2 rounded-md bg-blue-600 text-white text-sm hover:bg-blue-700",children:"새 파트너 프로필"})]}),S?e.jsx("div",{className:"text-gray-700 dark:text-gray-300",children:"로딩 중..."}):k?e.jsx("div",{className:"text-red-600 dark:text-red-400",children:k}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-4 py-2"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:u.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-sm text-gray-900 dark:text-gray-100",children:t.email??"-"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300",children:t.name??"-"}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300",children:t.company??"-"}),e.jsx("td",{className:"px-4 py-2 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"}`,children:t.status})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300",children:new Date(t.created_at).toLocaleString()}),e.jsxs("td",{className:"px-4 py-2 text-sm text-right space-x-2",children:[e.jsx("button",{onClick:()=>v(t.user_id),className:"px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200",children:"User ID 보기"}),e.jsx("button",{onClick:()=>D(t.user_id),className:"px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200",children:"할당"}),e.jsx("button",{onClick:()=>z(t.user_id,t.status),className:"px-2 py-1 text-xs rounded bg-blue-600 hover:bg-blue-700 text-white",children:"상태"}),e.jsx("button",{onClick:()=>U(t.user_id),className:"px-2 py-1 text-xs rounded bg-red-600 hover:bg-red-700 text-white",children:"삭제"})]})]},t.user_id))})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-lg",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"새 파트너 프로필"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"닫기"})]}),e.jsxs("form",{onSubmit:P(O),className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"이메일"}),e.jsx("input",{type:"email",className:"mt-1 w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2 text-sm",...n("email")}),c.email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"초기 비밀번호 (선택)"}),e.jsx("input",{type:"password",className:"mt-1 w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2 text-sm",...n("password")}),c.password&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:c.password.message})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"이름"}),e.jsx("input",{type:"text",className:"mt-1 w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2 text-sm",...n("name")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"회사"}),e.jsx("input",{type:"text",className:"mt-1 w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2 text-sm",...n("company")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"상태"}),e.jsxs("select",{className:"mt-1 w-full rounded border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2 text-sm",...n("status"),children:[e.jsx("option",{value:"active",children:"active"}),e.jsx("option",{value:"inactive",children:"inactive"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",disabled:N,className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50",children:N?"생성 중...":"생성"})})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-lg",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"페이지 할당"}),e.jsx("button",{onClick:()=>y(null),className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"닫기"})]}),e.jsx("div",{className:"p-4 space-y-3 max-h-[70vh] overflow-auto",children:j.length===0?e.jsx("div",{className:"text-gray-700 dark:text-gray-300",children:"등록된 파트너 페이지가 없습니다."}):j.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-800 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:p.includes(t.id),onChange:a=>{const r=a.target.checked;f(s=>r?[...s,t.id]:s.filter(h=>h!==t.id))}}),e.jsx("span",{children:t.title})]},t.id))}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-800 flex justify-end",children:e.jsx("button",{onClick:L,className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white",children:"저장"})})]})}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"User ID"}),e.jsx("button",{onClick:()=>v(null),className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"닫기"})]}),e.jsx("div",{className:"p-4",children:e.jsx("code",{className:"block p-3 bg-gray-100 dark:bg-gray-800 rounded text-sm text-gray-800 dark:text-gray-200 break-all",children:w})})]})})]})};export{J as default};
